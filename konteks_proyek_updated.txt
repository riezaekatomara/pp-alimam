# KONTEKS PROYEK: Website PPDB Ponpes Al-Imam

## LATAR BELAKANG
Saya sedang mengembangkan website PPDB (Penerimaan Pesantren Baru) untuk **Pondok Pesantren Al-Imam**. Mudir (kepala) Ponpes Al-Imam adalah orang yang sama dengan mudir Pesantren Al-Andalus Ulul Albaab, sehingga **sistem informasi pendaftaran harus mengikuti alur yang sama persis** dengan sistem Pesantren Al-Andalus Ulul Albaab.

## TECH STACK
- **Framework**: Next.js 16 (App Router)
- **Database**: Supabase (14 tabel sudah tersambung)
- **ORM**: Prisma
- **Styling**: Tailwind CSS + Shadcn/ui
- **Authentication**: Supabase Auth
- **WhatsApp Gateway**: Fonnte (untuk OTP & notifikasi)

## PROGRESS SAAT INI

### âœ… Halaman yang Sudah Ada:
**Homepage Components:**
- Navbar
- Hero Section
- About Section
- Features Section
- Gallery Section
- Testimonials Section
- Calendar Section
- Contact Section
- Footer

**Halaman Lainnya:**
- Detail Kegiatan
- Detail Fasilitas
- Informasi PPDB
- Login Page (Nomor Pendaftaran + Password)
- Dashboard Pendaftar (struktur dasar)

### ðŸ“Š Database Supabase:
14 tabel sudah dibuat dan tersambung ke Next.js:
1. data_pendaftar (core table)
2. data_orang_tua
3. data_sekolah
4. data_tujuan
5. data_pembayaran
6. data_ujian
7. data_berkas
8. tahun_ajaran
9. admin_users
10. data_rapor âœ… (baru dibuat)
11. data_prestasi âœ… (baru dibuat)
12. data_kesehatan âœ… (baru dibuat)
13. data_asrama âœ… (baru dibuat)
14. reservasi_psb âœ… (baru dibuat)

---

## SISTEM REFERENSI: PESANTREN AL-ANDALUS ULUL ALBAAB

### âš ï¸ KOREKSI ALUR LENGKAP PENDAFTARAN (8 TAHAP):

**TAHAP 1: Mengisi Form Pendaftaran Awal + Verifikasi WhatsApp**

**A. Mengisi Form Sederhana:**
- User mengakses website PSB `/daftar`
- Mengisi formulir pendaftaran SEDERHANA dengan data:
  - Nama Lengkap Calon Santri
  - NIK (Nomor Induk Kependudukan) - 16 digit
  - Tanggal Lahir (DD/MM/YYYY)
  - Nomor WhatsApp Orang Tua (aktif)
  - Jenis Kelamin (Laki-laki/Perempuan)
  - Jenjang Tujuan (MTs/I'dad Lughowi/MA)
- Klik tombol "Daftar Sekarang"

**B. Verifikasi WhatsApp:**
- Sistem kirim **Kode OTP 6 digit** via WhatsApp
  - Contoh: "Kode verifikasi PPDB Al-Imam Anda: **123456**. Berlaku 5 menit."
- Pop-up muncul: "Masukkan kode verifikasi dari WhatsApp"
- User input kode OTP â†’ Klik "Verifikasi"
- Jika kode salah: Error message + tombol "Kirim Ulang Kode"
- Jika kode benar: Lanjut ke proses berikutnya

**C. Generate Kredensial:**
- Sistem **AUTO-GENERATE**:
  - âœ… **Nomor Pendaftaran** (format: `B2600001`)
    - Format: `[PREFIX][YY][NNNNN]`
    - Contoh: B26 (prefix+tahun) + 00001 (urut)
  - âœ… **Password Default** (format: `MT67890123`)
    - Format: `[JENJANG_CODE][NIK_8_DIGIT_TERAKHIR]`
    - MTs â†’ MT, I'dad Lughowi â†’ IL, MA â†’ MA
    - Password = Kode Jenjang + 8 digit terakhir NIK
- Insert data ke database (`data_pendaftar`)
- Set flag: `is_verified_whatsapp = true`

**D. Notifikasi Sukses:**
- Pop-up di website menampilkan:
  ```
  ðŸŽ‰ Alhamdulillah! Pendaftaran Berhasil

  Nomor Pendaftaran: B2600001
  Password: MT67890123

  ðŸ“Œ PENTING: 
  - Simpan nomor pendaftaran & password Anda
  - Gunakan untuk login ke dashboard
  - Password bisa diganti di menu profil
  ```
- Kirim notifikasi WhatsApp:
  ```
  Assalamu'alaikum Bapak/Ibu,

  Alhamdulillah, pendaftaran PPDB Al-Imam berhasil! ðŸŽ‰

  ðŸ“ Data Login Anda:
  Nomor Pendaftaran: B2600001
  Password: MT67890123

  ðŸ”— Login sekarang: https://ppdb.al-imam.com/login

  Langkah selanjutnya:
  1ï¸âƒ£ Login ke dashboard
  2ï¸âƒ£ Download Surat Informasi
  3ï¸âƒ£ Transfer biaya pendaftaran
  4ï¸âƒ£ Upload bukti pembayaran

  Jazakumullahu khairan ðŸ¤²
  ```
- Auto-redirect ke halaman login setelah 5 detik

---

**TAHAP 2: Membayar Biaya Pendaftaran**
- User **LOGIN** menggunakan:
  - Nomor Pendaftaran: `B2600001`
  - Password: `MT67890123` (atau yang sudah diganti)
- Masuk ke Dashboard Pendaftar
- Tab **"Download Berkas"** â†’ Download **Surat Informasi**
  - Surat berisi: Nomor rekening, nominal biaya, tata cara transfer
- Transfer biaya pendaftaran ke rekening pesantren
- Tab **"Status Pembayaran"** â†’ Upload **Bukti Transfer**
- Admin verifikasi pembayaran (10-30 menit)
- Status berubah: `is_paid = true`

---

**TAHAP 3: Melengkapi Data & Upload Berkas**

**Setelah pembayaran terverifikasi**, user wajib:

**A. Isi Form Data Lengkap (8 Steps):**
- Akses: `/dashboard/lengkapi-data`
- Step 1: Data Pribadi Lengkap
  - Nama, NIK, NISN, TTL, Golongan Darah, Anak ke-, Jumlah Saudara
- Step 2: Alamat Lengkap
  - Alamat, RT/RW, Kelurahan, Kecamatan, Kab/Kota, Provinsi, Kode Pos
- Step 3: Data Sekolah Asal
  - Nama Sekolah, NPSN, Alamat Sekolah, Tahun Lulus
- Step 4: Data Ayah
  - Status, Nama, NIK, TTL, Pendidikan, Pekerjaan, Penghasilan, Kontak
- Step 5: Data Ibu
  - Same fields as Ayah
- Step 6: Data Wali (Optional)
  - Jika ada wali, isi data wali
- Step 7: Data Tambahan
  - Hobi, Cita-cita, Jumlah Hafalan Quran, Pilihan Asrama
- Step 8: Review & Submit
  - Preview semua data â†’ Checkbox konfirmasi â†’ Submit

**B. Upload Berkas Persyaratan:**
- Tab **"Upload Berkas"** di dashboard
- Upload 9 dokumen:
  - âœ… Foto Calon Santri (JPG, max 1MB)
  - âœ… Surat Kesanggupan (PDF, template disediakan)
  - âœ… Rapor Semester 1 (PDF/JPG, max 1MB)
  - âœ… Rapor Semester 2 (PDF/JPG, max 1MB)
  - âœ… Akta Kelahiran (PDF/JPG, max 1MB)
  - âœ… Kartu Keluarga (PDF/JPG, max 1MB)
  - â“ Surat Kesehatan (Optional)
  - â“ Hasil Tes HBsAg (Optional)
  - â“ Sertifikat Hafalan (Optional)

**C. Tracking Status:**
- Tab **"Kelengkapan Berkas"** menampilkan:
  - Status Upload: Sudah âœ… / Belum âŒ
  - Status Verifikasi: Sudah âœ… / Menunggu â¸ï¸
  - Last Upload: Tanggal & waktu
  - Last Verified: Tanggal & waktu

---

**TAHAP 4: Verifikasi (Admin)**
- Admin memverifikasi kelengkapan berkas
- Admin memverifikasi pembayaran pendaftaran
- Sistem menampilkan label "Baru (U)" untuk berkas umum yang baru diupload
- Sistem menampilkan label "Baru (K)" untuk berkas kesehatan yang baru diupload
- Setelah semua verified â†’ Auto-trigger Tahap 5

---

**TAHAP 5: Menerima Surat Undangan Seleksi/TES**
- Santri otomatis mendapat undangan setelah:
  - âœ… Semua berkas terverifikasi
  - âœ… Pembayaran pendaftaran terverifikasi
- Tab **"Undangan Seleksi"** di dashboard menampilkan:
  - Hari & Tanggal Ujian
  - Pukul (waktu)
  - Jenis Ujian: Online (Google Meet) / Offline (Lokasi)
  - Link ujian (jika online)
  - Alamat lokasi (jika offline)
  - Link WhatsApp Group untuk sosialisasi
- Notifikasi WhatsApp dikirim otomatis
- Download **Surat Undangan** (PDF)
- Materi Tes Seleksi:
  1. Tes Membaca Al-Quran
  2. Tes Kepribadian
  3. Tes Akademik (PAI, Bahasa Indonesia, Matematika)
  4. Tes Wawancara (calon santri)
  5. Wawancara Tertulis Orang Tua
  6. Wawancara Kesehatan

---

**TAHAP 6: Mengikuti Ujian Seleksi**
- Sesuai jadwal dan jenis ujian (online/offline)
- Admin dapat import status kehadiran via CSV
- Format CSV: nomor pendaftaran tanpa header, delimiter koma
- Status kehadiran: Sudah/Online/Belum/Tidak

---

**TAHAP 7: Pengumuman Hasil**
- Tab **"Pengumuman"** di dashboard menampilkan:
  - Status Penerimaan:
    - âœ… Diterima di Pusat
    - âœ… Diterima di Cabang [nama cabang]
    - âŒ Tidak Diterima
    - â¸ï¸ Mundur
  - Jalur Penerimaan: Murni / Rekomendasi
  - Tanggal Pengumuman
  - Download **Surat Pengumuman** (PDF)
- Notifikasi WhatsApp otomatis
- Admin dapat import hasil seleksi via CSV

---

**TAHAP 8: Daftar Ulang**
- Pembayaran Biaya Daftar Ulang
- Nominal dan rekening tercantum di Surat Pengumuman
- Tab **"Status Pembayaran"** â†’ Upload bukti daftar ulang
- Admin verifikasi pembayaran
- Download **Bukti Daftar Ulang** setelah pembayaran terverifikasi

---

## ðŸ” SISTEM PASSWORD

### Password Default Strategy:
**Format: `[JENJANG_CODE][NIK_8_DIGIT_TERAKHIR]`**

```javascript
// Contoh:
// User: NIK 3201234567890123, Jenjang MTs
// Password: MT67890123

// User: NIK 3201234567890123, Jenjang I'dad Lughowi  
// Password: IL67890123

// User: NIK 3201234567890123, Jenjang MA
// Password: MA67890123
```

### Karakteristik Password:
- âœ… Panjang 10 karakter (cukup aman)
- âœ… User bisa cek KTP kalau lupa (8 digit terakhir NIK)
- âœ… Ada identitas jenjang (MT/IL/MA)
- âœ… Admin mudah bantu reset (tinggal lihat NIK + jenjang)
- âœ… **Password bisa diganti** oleh user kapan saja (optional, tidak wajib)
- âœ… Tidak perlu forced password change

### Fitur Ganti Password:
- Menu: Dashboard â†’ Profil â†’ Ganti Password
- Input: Password Lama, Password Baru, Konfirmasi Password Baru
- Validasi: Password baru minimal 8 karakter
- User bebas ganti atau tetap pakai password default

---

## ðŸ“± SISTEM VERIFIKASI WHATSAPP

### A. Kirim Kode OTP:
```
API: POST /api/register/send-otp
Body: {
  no_hp: "081234567890",
  nama: "Ahmad Zaki"
}

Response: {
  success: true,
  message: "Kode OTP telah dikirim ke WhatsApp Anda",
  otp_sent_at: "2026-01-20T10:30:00Z"
}
```

### B. Verifikasi Kode OTP:
```
API: POST /api/register/verify-otp
Body: {
  no_hp: "081234567890",
  otp_code: "123456"
}

Response: {
  success: true,
  data: {
    nomor_pendaftaran: "B2600001",
    password: "MT67890123",
    nama_lengkap: "Ahmad Zaki Mubarak",
    jenjang: "MTs"
  }
}
```

### C. Kirim Notifikasi Sukses:
```
API: POST /api/register/send-notification
Body: {
  no_hp: "081234567890",
  nomor_pendaftaran: "B2600001",
  password: "MT67890123"
}
```

### Format Kode OTP:
- 6 digit angka random (contoh: 123456)
- Berlaku 5 menit
- Disimpan di database dengan hash
- Maksimal 3x salah input â†’ Blokir 15 menit

---

## ðŸ”¢ FORMAT NOMOR PENDAFTARAN

### Format Lengkap:
```
[PREFIX][YY][NNNNN]

Keterangan:
- PREFIX = B (tetap untuk semua jenjang)
- YY = Tahun (2 digit terakhir, contoh: 26 untuk 2026)
- NNNNN = Nomor urut (5 digit, auto-increment, max 99999)

Contoh:
- B2600001 (pendaftar pertama tahun 2026)
- B2600002 (pendaftar kedua tahun 2026)
- B2612345 (pendaftar ke-12345 tahun 2026)
```

### Logika Auto-Generate:
1. Ambil tahun ajaran aktif dari tabel `tahun_ajaran`
2. Ambil prefix (default: "B")
3. Ambil nomor urut terakhir
4. Increment +1
5. Format: `${prefix}${tahun}${String(urut).padStart(5, '0')}`

---

## FITUR DASHBOARD PENDAFTAR (USER):

**Tab Menu:**
1. ðŸ“Š **Data Pendaftaran** - menampilkan data pribadi lengkap
2. ðŸ“¥ **Download Berkas** - download template & surat
   - Bukti Pendaftaran (PDF)
   - Surat Informasi (PDF)
   - Template Surat Kesanggupan (DOCX)
   - Panduan Upload Dokumen (PDF)
3. ðŸ“¤ **Upload Berkas** - upload 9 dokumen persyaratan
4. ðŸ“ **Kelengkapan Berkas** - tracking status upload & verifikasi
5. ðŸ’° **Status Pembayaran** - info pembayaran & upload bukti
   - Biaya Pendaftaran
   - Biaya Daftar Ulang (setelah diterima)
6. ðŸ“§ **Undangan Seleksi** - info jadwal dan link ujian
7. ðŸ“¢ **Pengumuman** - hasil seleksi dan status penerimaan
8. ðŸ” **Profil** - ganti password (optional)

**Progress Tracker:**
Visual 8 tahapan dengan indikator:
- âœ… Hijau (completed)
- ðŸ”„ Kuning (in progress)
- â¸ï¸ Abu-abu (pending)

**Data yang Ditampilkan:**
- Data Santri (nama, TTL, jenjang, alamat lengkap, dll)
- Nomor Pendaftaran (ditampilkan besar/prominent)
- Data Sekolah Asal (nama sekolah, NPSN, alamat)
- Data Ayah (nama, TTL, pekerjaan, penghasilan, pendidikan, kontak)
- Data Ibu (sama seperti ayah)
- Data Wali (jika ada)
- Data Tujuan (jenjang, kelas, tahun pelajaran, asrama)
- Data Rapor (nilai semester 1 & 2 dengan rata-rata)
- Data Prestasi
- Data Kesehatan
- Data Pembayaran (pendaftaran & daftar ulang)

---

## FITUR BACKEND/ADMIN:

*(Fitur admin tetap sama seperti dokumen sebelumnya)*

**1. DASHBOARD STATISTIK**
**2. FILTER DATA (Multi-kriteria)**
**3. MODUL KEUANGAN**
**4. MODUL PEMBERKASAN**
**5. MODUL UJIAN SELEKSI**
**6. MODUL KESEHATAN**
**7. MODUL PENERIMAAN**
**8. MODUL RESERVASI PSB**
**9. MODUL PENGATURAN**
**10. MODUL MANAJEMEN USER (RBAC)**
**11. MODUL PUBLIKASI**

---

## PRINSIP DESAIN SISTEM:

1. **User-Friendly:**
   - Interface intuitif
   - Progress tracker visual
   - Notifikasi jelas via WhatsApp

2. **Transparent:**
   - User bisa lihat status real-time
   - History log semua aktivitas

3. **Efficient:**
   - OTP verification cepat
   - Auto-generate kredensial
   - Bulk import/export
   - Multi-filter canggih

4. **Secure:**
   - WhatsApp OTP verification
   - Password hashing (bcrypt)
   - Role-based access
   - Audit trail

5. **Scalable:**
   - Support multi-tahun pelajaran
   - Support multi-jenjang
   - Support multi-cabang

---

## CATATAN PENTING:

### Perbedaan dengan Sistem Lama:
âŒ **YANG DIHAPUS:**
- User buat password sendiri saat registrasi
- Form pendaftaran kompleks di awal

âœ… **YANG DITAMBAHKAN:**
- Verifikasi WhatsApp dengan OTP
- Password auto-generated oleh sistem
- Form awal hanya 5 field (sederhana)
- Form lengkap diisi setelah bayar

### Technical Requirements:
- Next.js 16 (App Router)
- Supabase (Database + Storage)
- Prisma ORM
- Tailwind CSS + Shadcn/ui
- Fonnte WhatsApp Gateway
- React Hook Form + Zod validation
- PDF generation library (jsPDF/PDFKit)

### Best Practices:
- Production-ready code
- Mobile-first responsive design
- Accessibility (a11y) compliant
- SEO optimized
- Performance optimized (Lighthouse > 90)
- TypeScript strict mode
- Error handling comprehensive
- Loading states everywhere

---

**Last Updated: 20 Januari 2026 - 21:00 WIB**
**Updated By: Development Team**
