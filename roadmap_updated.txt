# ğŸ—ºï¸ ROADMAP LENGKAP - PPDB PONPES AL-IMAM

**Last Updated: 20 Januari 2026 - 21:00 WIB**
**Current Status: PHASE 2 - Form Pendaftaran + OTP System**

---

## ğŸ“Š OVERVIEW PROGRESS

```
Phase 0: âœ… DONE      (20 Jan 2026) - Authentication System
Phase 1: âœ… DONE      (20 Jan 2026) - Database Schema  
Phase 2: ğŸ”„ CURRENT  (20 Jan 2026) - Form Pendaftaran + OTP
Phase 3: â¸ï¸ PENDING              - Dashboard Pendaftar
Phase 4: â¸ï¸ PENDING              - Admin Dashboard
Phase 5: â¸ï¸ PENDING              - Advanced Features
```

---

## âœ… PHASE 0: AUTHENTICATION SYSTEM (DONE)

### Completed Tasks:
- [x] Next.js 16 setup with App Router
- [x] Supabase connection configured
- [x] Middleware with Sliding Session (7 days)
- [x] Idle Timeout Tracker (30 minutes)
- [x] Login page (Nomor Pendaftaran + Password)
- [x] Protected routes implementation
- [x] Session monitoring component

### Files Created:
```
âœ… middleware.ts
âœ… src/lib/auth.ts
âœ… src/components/auth/IdleTimeoutTracker.tsx
âœ… src/components/auth/SessionMonitor.tsx
âœ… src/app/login/page.tsx
âœ… src/app/dashboard/layout.tsx
```

**Status: 100% Complete**
**Completion Date: 20 Januari 2026**

---

## âœ… PHASE 1: DATABASE SCHEMA COMPLETION (DONE)

### Completed Tasks:
- [x] data_rapor table created
- [x] data_prestasi table created
- [x] data_kesehatan table created
- [x] data_asrama table created
- [x] reservasi_psb table created
- [x] Complete Prisma schema (14 tables)
- [x] TypeScript types generated
- [x] Storage documentation

### Files Created:
```
âœ… migrations/001_create_missing_tables.sql
âœ… prisma/schema.prisma
âœ… src/types/database-extended.ts
âœ… docs/STORAGE_SETUP.md
```

**Status: 100% Complete**
**Completion Date: 20 Januari 2026**

---

## ğŸ”„ PHASE 2: FORM PENDAFTARAN + OTP SYSTEM (IN PROGRESS)

### Target: Form registrasi sederhana dengan WhatsApp OTP verification

### Tasks Checklist:

#### 2.1 Form Pendaftaran Awal (0/6)
- [ ] **Form Component** (`/daftar/page.tsx`)
  - Fields: NIK (16 digit), Nama Lengkap, Tanggal Lahir, No WhatsApp, Jenis Kelamin, Jenjang
  - Validation: Zod schema
  - UI: Responsive, accessible, user-friendly
  
- [ ] **OTP Modal Component**
  - Input 6-digit OTP code
  - Countdown timer (5 minutes)
  - Resend OTP button
  - Error handling
  
- [ ] **Success Modal Component**
  - Display Nomor Pendaftaran
  - Display Password Default
  - Copy to clipboard buttons
  - Auto-redirect to login (5s)

- [ ] **API Route: Send OTP** (`/api/register/send-otp/route.ts`)
  - Validate phone number
  - Generate 6-digit OTP
  - Store OTP in database (hashed, expires 5 min)
  - Send via Fonnte WhatsApp API
  - Rate limiting (max 3 per hour per number)

- [ ] **API Route: Verify OTP** (`/api/register/verify-otp/route.ts`)
  - Validate OTP code
  - Check expiration
  - Max 3 attempts, then block 15 min
  - If valid: trigger registration

- [ ] **API Route: Complete Registration** (`/api/register/complete/route.ts`)
  - Auto-generate Nomor Pendaftaran
  - Auto-generate Password Default
  - Hash password (bcrypt)
  - Insert to database
  - Send WhatsApp notification
  - Return credentials

#### 2.2 Password Generation Logic (0/3)
- [ ] **Function: Generate Nomor Pendaftaran**
  ```typescript
  // Format: B2600001
  // B = prefix, 26 = year, 00001 = sequence
  ```

- [ ] **Function: Generate Password Default**
  ```typescript
  // Format: MT67890123
  // MT = jenjang code, 67890123 = last 8 digits NIK
  ```

- [ ] **Password Utilities**
  - Hash password (bcrypt)
  - Validate password strength
  - Change password function (for later)

#### 2.3 WhatsApp Integration (0/3)
- [ ] **Fonnte Setup**
  - Get API key
  - Configure webhook (optional)
  - Test connection

- [ ] **WhatsApp Templates**
  - OTP Message: "Kode verifikasi PPDB Al-Imam: {code}. Berlaku 5 menit."
  - Success Message: Nomor Pendaftaran + Password + Login Link
  - Payment Reminder (for later)

- [ ] **Helper Functions**
  - `sendWhatsAppOTP()`
  - `sendRegistrationSuccess()`
  - Format phone number (normalize)

#### 2.4 Validation & Security (0/4)
- [ ] **Zod Schemas**
  - Registration form schema
  - OTP verification schema
  - Phone number validation (Indonesian format)
  - NIK validation (16 digits, Luhn algorithm)

- [ ] **Rate Limiting**
  - Max 3 OTP requests per hour per phone
  - Max 3 OTP verification attempts
  - Block after failed attempts (15 min)

- [ ] **Security Measures**
  - Hash OTP before storing
  - CSRF protection
  - Input sanitization
  - SQL injection prevention (Prisma)

- [ ] **Error Handling**
  - User-friendly error messages
  - Logging for debugging
  - Fallback for WhatsApp failures

### Deliverables:
```
ğŸ“„ src/app/daftar/page.tsx (main registration page)
ğŸ“„ src/components/registration/RegistrationForm.tsx
ğŸ“„ src/components/registration/OTPModal.tsx
ğŸ“„ src/components/registration/SuccessModal.tsx
ğŸ“„ src/app/api/register/send-otp/route.ts
ğŸ“„ src/app/api/register/verify-otp/route.ts
ğŸ“„ src/app/api/register/complete/route.ts
ğŸ“„ src/lib/whatsapp/fonnte.ts
ğŸ“„ src/lib/utils/password.ts
ğŸ“„ src/lib/utils/nomor-pendaftaran.ts
ğŸ“„ src/lib/validations/registration.ts
ğŸ“„ src/types/registration.ts
```

**Estimated Time: 4-6 hours**
**Start Date: 20 Jan 2026**
**Target Completion: 21 Jan 2026**

---

## â¸ï¸ PHASE 3: FORM DATA LENGKAP + DASHBOARD (PENDING)

### Target: Multi-step form (8 steps) + Dashboard tabs

### Tasks Checklist:

#### 3.1 Form Data Lengkap - Multi-Step Form (0/9)
**Location: `/dashboard/lengkapi-data/page.tsx`**

- [ ] **Form Infrastructure**
  - Multi-step context provider
  - Progress indicator (1/8, 2/8, etc.)
  - Navigation (Next, Previous, Save Draft)
  - Form state management

- [ ] **Step 1: Data Pribadi Lengkap**
  - Nama, NIK, NISN, Tempat Lahir, Tanggal Lahir
  - Jenis Kelamin, Golongan Darah
  - Anak ke berapa dari berapa saudara

- [ ] **Step 2: Alamat Lengkap**
  - Alamat, RT/RW, Kelurahan, Kecamatan
  - Kabupaten/Kota, Provinsi, Kode Pos
  - No HP, Email

- [ ] **Step 3: Data Sekolah Asal**
  - Jenjang sebelumnya
  - Nama Sekolah, NPSN
  - Alamat Sekolah
  - Tahun Lulus

- [ ] **Step 4: Data Ayah**
  - Status Ayah (Hidup/Meninggal)
  - Nama, NIK, TTL
  - Pendidikan, Pekerjaan, Penghasilan
  - No HP, Email, Alamat

- [ ] **Step 5: Data Ibu**
  - Same fields as Step 4

- [ ] **Step 6: Data Wali (Optional)**
  - Toggle: "Ada Wali?"
  - Nama, NIK, TTL
  - Hubungan dengan santri
  - Pendidikan, Pekerjaan, Penghasilan
  - No HP

- [ ] **Step 7: Data Tambahan**
  - Hobi, Cita-cita
  - Jumlah Hafalan Al-Quran
  - Sumber Informasi PPDB
  - Pilihan Asrama (Ya/Tidak)
  - Bersedia di Cabang (Ya/Tidak)

- [ ] **Step 8: Review & Submit**
  - Display all data in sections
  - Edit buttons per section
  - Checkbox: "Data sudah benar"
  - Submit button

#### 3.2 Dashboard Tabs (0/8)

- [ ] **Tab 1: Data Pendaftaran**
  - Display all registration data
  - Nomor Pendaftaran (prominent)
  - Edit button for limited fields
  - Current status badge

- [ ] **Tab 2: Download Berkas**
  - Bukti Pendaftaran (PDF)
  - Surat Informasi (PDF)
  - Template Surat Kesanggupan (DOCX)
  - Panduan Upload Dokumen (PDF)

- [ ] **Tab 3: Upload Berkas**
  - Drag & drop file upload
  - 9 document types
  - File validation (type, size)
  - Preview & re-upload

- [ ] **Tab 4: Kelengkapan Berkas**
  - Checklist table
  - Status: Upload (âœ…/âŒ), Verifikasi (âœ…/â¸ï¸)
  - Last upload/verification timestamp

- [ ] **Tab 5: Status Pembayaran**
  - Payment details (amount, bank, account)
  - Upload bukti transfer
  - Verification status
  - Daftar ulang section (after admission)

- [ ] **Tab 6: Undangan Seleksi**
  - Exam schedule
  - Google Meet link (if online)
  - Location details (if offline)
  - Download exam guidelines

- [ ] **Tab 7: Pengumuman**
  - Admission result
  - Acceptance status with icon
  - Download announcement letter (PDF)
  - Next steps

- [ ] **Tab 8: Progress Tracker**
  - Visual 8-stage progress
  - Color-coded: âœ… Done, ğŸ”„ Progress, â¸ï¸ Pending
  - Auto-update based on stage

### Deliverables:
```
ğŸ“„ src/app/dashboard/lengkapi-data/page.tsx
ğŸ“„ src/components/forms/multi-step/FormContext.tsx
ğŸ“„ src/components/forms/multi-step/ProgressIndicator.tsx
ğŸ“„ src/components/forms/steps/Step1DataPribadi.tsx
... (8 step components)
ğŸ“„ src/components/dashboard/DashboardTabs.tsx
ğŸ“„ src/components/dashboard/tabs/DataPendaftaran.tsx
... (8 tab components)
ğŸ“„ src/lib/validations/data-lengkap.ts
ğŸ“„ src/lib/pdf/generators/bukti-pendaftaran.ts
```

**Estimated Time: 3-4 days**
**Dependencies: Phase 2 must be 100% complete**

---

## â¸ï¸ PHASE 4: ADMIN DASHBOARD (PENDING)

*(Same as before - no changes)*

**Estimated Time: 1-2 weeks**

---

## â¸ï¸ PHASE 5: ADVANCED FEATURES (PENDING)

*(Same as before - no changes)*

**Estimated Time: 1-2 weeks**

---

## ğŸ“ˆ OVERALL TIMELINE

```
Phase 0: âœ… DONE (1 day) - 20 Jan 2026
Phase 1: âœ… DONE (3 hours) - 20 Jan 2026
Phase 2: ğŸ”„ CURRENT (4-6 hours) - 20-21 Jan 2026
Phase 3: â¸ï¸ PENDING (3-4 days) - 22-25 Jan 2026
Phase 4: â¸ï¸ PENDING (1-2 weeks) - 26 Jan - 8 Feb 2026
Phase 5: â¸ï¸ PENDING (1-2 weeks) - 9-22 Feb 2026

TOTAL ESTIMATED TIME: 4-5 weeks
TARGET COMPLETION: Mid-February 2026
```

---

## ğŸ¯ CURRENT ACTION ITEMS

**NOW: Phase 2 - Form Pendaftaran + OTP System**

### Immediate Next Steps:
1. âœ… Setup Fonnte WhatsApp API
2. âœ… Create registration form component
3. âœ… Create OTP modal component
4. âœ… Create API routes (send-otp, verify-otp, complete)
5. âœ… Implement password generation logic
6. âœ… Test end-to-end flow

### What You Need to Provide:
- [ ] **Fonnte API Key** (atau pakai simulasi dulu)
- [ ] **Confirm Prefix Nomor Pendaftaran** (default: "B")
- [ ] **Confirm Password Format** (default: Jenjang + NIK 8 digit)

---

**END OF ROADMAP**
**Next: Start coding Form Pendaftaran!** ğŸš€
